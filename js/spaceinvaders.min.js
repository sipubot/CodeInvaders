function GameImages(){this.keyboardImageCode=["iVBORw0KGgoAAAANSUhEUgAAAFAAAAAqBAMAAADWhsE5AAAAG1BMVEXX19fm5uYAAAD09PSqqqq8vLz///84ODisrKx1VPgwAAAAzklEQVQ4y8WVQQrCMBBFB3qCCKJLGVpwawNeYOYC4qJrF71Ab6Ant5k2M4KEyS6fHwKfD+VNUgLXUKUPvOuKZwjPeE9LfYxxzn5pGiD0TOECnfoAMGbfNG1bXHBIS31CnLIfmq7FOtUXZY6eo8zRQArumZlaFmWOnhEHofax99vD5H6b2hYXdLGV2mNWaiZn3kytikrtMWfqpLlso07Kf+ifWURti0KFU9lGLec5b5vJUqOmdY0y9l91eyon0q5oNxynbTNZKtTVz0f1g/QFvZHa0OlzTEYAAAAASUVORK5CYII="],
this.keycapList=["iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAD///9VVVUAAACqqqpggSv+AAAAAXRSTlMAQObYZgAAAEtJREFUCNd1jcENgDAMAy02cJsBaMIAICbI/kthRc2Te1nWycbhBXAlhZ1wqxBYybHIgDPnsxsFNXIsdyP+nNnOaKeW+yv6/QbeAh/+7w6qn7DhWwAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAD///9VVVUAAACqqqpggSv+AAAAAXRSTlMAQObYZgAAAExJREFUCNd1y8ENwCAMA8CIDVxlgOIwQCsmyP5LkUTwxB9bJ1kyJKubQ98aCrUtsIsgpZEdKUOj/pDuOUKoeI7YPFKv4cC+Vz6RWZEFlLYLYltjut4AAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAD///9VVVUAAACqqqpggSv+AAAAAXRSTlMAQObYZgAAADhJREFUCNdjIAYwKYGBA4OiIBgoM6iAaRFlBkVnY0EhiIihkpAiSMTRUMlJEUkNQheTMRgY4LEKACepCGT9ISzjAAAAAElFTkSuQmCC"];
}function Game(){this.config={bombRate:.05,bombMinVelocity:50,bombMaxVelocity:50,invaderInitialVelocity:25,invaderAcceleration:0,invaderDropDistance:20,rocketVelocity:120,
rocketMaxFireRate:2,gameWidth:400,gameHeight:300,fps:50,debugMode:!1,invaderRanks:1,invaderFiles:10,shipSpeed:120,levelDifficultyMultiplier:.2,pointsPerInvader:5
},this.lives=3,this.width=0,this.height=0,this.gameBounds={left:0,top:0,right:0,bottom:0},this.intervalId=0,this.score=0,this.stage=0,this.stageName=["ASSEMBLY","C","JAVA","JAVASCRIPT"],
this.level=1,this.stateStack=[],this.pressedKeys={},this.gameCanvas=null,this.sounds=null,this.backgroundScreen=null}function GameLoop(t){var e=t.currentState();if(e){
var i=1/t.config.fps,s=this.gameCanvas.getContext("2d");e.update&&e.update(t,i),e.draw&&e.draw(t,i,s)}}function WelcomeState(){}function GameOverState(){}function PlayState(t,e){
this.config=t,this.level=e,this.invaderCurrentVelocity=10,this.invaderCurrentDropDistance=0,this.invadersAreDropping=!1,this.lastRocketTime=null,this.ship=null,this.boss={},
this.invaders=[],this.rockets=[],this.bombs=[]}function PauseState(){}function LevelIntroState(t){this.level=t,this.countdownMessage="3",this.IntroStageWord="This is Just Game";
}function Ship(t,e){this.x=t,this.y=e,this.width=80,this.height=42}function Rocket(t,e,i){this.x=t,this.y=e,this.velocity=i}function Bomb(t,e,i){this.x=t,this.y=e,
this.velocity=i}function Invader(t,e,i,s,o){this.x=t,this.y=e,this.rank=i,this.file=s,this.type=o,this.width=18,this.height=14}function Boss(t,e,i){this.x=t,this.y=e,
this.stage=i,this.hp=1e3,this.movedirection=-1,this.width=80,this.height=40}function GameState(t,e,i,s,o,n){this.updateProc=t,this.drawProc=e,this.keyDown=i,this.keyUp=s,
this.enter=o,this.leave=n}function Sounds(){this.audioContext=null,this.sounds={}}GameImages.prototype.keyboard=function(){var t=new Image;t.src="data:image/png;base64,"+this.keyboardImageCode,
this.keyboard=t},GameImages.prototype.keycaps=function(){for(var t=[this.keycapList.length],e=0;e<this.keycapList.length;e++)t[e]=new Image,t[e].src="data:image/png;base64,"+this.keycapList[e];
this.keycaps=t};var gameImages=new GameImages;gameImages.keyboard(),gameImages.keycaps(),Game.prototype.initialise=function(t){this.gameCanvas=t,this.width=t.width,
this.height=t.height,this.gameBounds={left:t.width/2-this.config.gameWidth/2,right:t.width/2+this.config.gameWidth/2,top:t.height/2-this.config.gameHeight/2,bottom:t.height/2+this.config.gameHeight/2
}},Game.prototype.moveToState=function(t){this.currentState()&&this.currentState().leave&&(this.currentState().leave(game),this.stateStack.pop()),t.enter&&t.enter(game),
this.stateStack.pop(),this.stateStack.push(t)},Game.prototype.start=function(){this.moveToState(new WelcomeState),this.lives=3,this.config.debugMode=/debug=true/.test(window.location.href);
var t=this;this.intervalId=setInterval(function(){GameLoop(t)},1e3/this.config.fps)},Game.prototype.currentState=function(){return this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;
},Game.prototype.mute=function(t){t===!0?this.sounds.mute=!0:t===!1?this.sounds.mute=!1:this.sounds.mute=!this.sounds.mute},Game.prototype.pushState=function(t){
t.enter&&t.enter(game),this.stateStack.push(t)},Game.prototype.popState=function(){this.currentState()&&(this.currentState().leave&&this.currentState().leave(game),
this.stateStack.pop())},Game.prototype.stop=function(){clearInterval(this.intervalId)},Game.prototype.keyDown=function(t){this.pressedKeys[t]=!0,this.currentState()&&this.currentState().keyDown&&this.currentState().keyDown(this,t);
},Game.prototype.keyUp=function(t){delete this.pressedKeys[t],this.currentState()&&this.currentState().keyUp&&this.currentState().keyUp(this,t)},WelcomeState.prototype.enter=function(t){
t.sounds=new Sounds,t.sounds.init(),t.sounds.loadSound("shoot","sounds/shoot.wav"),t.sounds.loadSound("bang","sounds/bang.wav"),t.sounds.loadSound("explosion","sounds/explosion.wav");
},WelcomeState.prototype.update=function(t,e){},WelcomeState.prototype.draw=function(t,e,i){i.clearRect(0,0,t.width,t.height),i.font="30px Arial",i.fillStyle="#ffffff",
i.textBaseline="center",i.textAlign="center",i.fillText("Code Invaders",t.width/2,t.height/2-40),i.font="16px Arial",i.fillText("Select Stage",t.width/2,t.height/2);
for(var s=0;s<t.stageName.length;s++)t.stage===s?(i.strokeStyle="#ffffff",i.fillStyle="#ffffff"):(i.strokeStyle="#999999",i.fillStyle="#999999"),i.strokeRect(t.width/2-255+130*s,t.height/2+300,120,60),
i.fillText(t.stageName[s],t.width/2-195+130*s,t.height/2+335,120,60)},WelcomeState.prototype.keyDown=function(t,e){32==e&&(t.level=1,t.score=0,t.lives=3,t.moveToState(new LevelIntroState(t.level))),
37==e&&t.stage>0&&t.stage--,39==e&&t.stage<3&&t.stage++},GameOverState.prototype.update=function(t,e){},GameOverState.prototype.draw=function(t,e,i){i.clearRect(0,0,t.width,t.height),
i.font="30px Arial",i.fillStyle="#ffffff",i.textBaseline="center",i.textAlign="center",i.fillText("Game Over!",t.width/2,t.height/2-40),i.font="16px Arial",i.fillText("You scored "+t.score+" and got to level "+t.level,t.width/2,t.height/2),
i.font="16px Arial",i.fillText("Press 'Space' to play again.",t.width/2,t.height/2+40)},GameOverState.prototype.keyDown=function(t,e){32==e&&(t.lives=3,t.score=0,
t.level=1,t.moveToState(new LevelIntroState(1)))},PlayState.prototype.enter=function(t){this.ship=new Ship(t.width/2,t.gameBounds.bottom),this.invaderCurrentVelocity=10,
this.invaderCurrentDropDistance=0,this.invadersAreDropping=!1;var e=this.level*this.config.levelDifficultyMultiplier;this.shipSpeed=this.config.shipSpeed,this.invaderInitialVelocity=this.config.invaderInitialVelocity+e*this.config.invaderInitialVelocity,
this.bombRate=this.config.bombRate+e*this.config.bombRate,this.bombMinVelocity=this.config.bombMinVelocity+e*this.config.bombMinVelocity,this.bombMaxVelocity=this.config.bombMaxVelocity+e*this.config.bombMaxVelocity;
for(var i=this.config.invaderRanks,s=this.config.invaderFiles,o=[],n=0;n<i;n++)for(var h=0;h<s;h++)o.push(new Invader(t.width/2+200*(s/2-h)/s,t.gameBounds.top+20*n,n,h,"Invader"));
this.invaders=o,this.invaderCurrentVelocity=this.invaderInitialVelocity,this.invaderVelocity={x:-this.invaderInitialVelocity,y:0},this.invaderNextVelocity=null;var a=new Boss(t.width/2,200,t.stage);
this.boss=a},PlayState.prototype.update=function(t,e){t.pressedKeys[37]&&(this.ship.x-=this.shipSpeed*e),t.pressedKeys[39]&&(this.ship.x+=this.shipSpeed*e),t.pressedKeys[32]&&this.fireRocket(),
this.ship.x<t.gameBounds.left&&(this.ship.x=t.gameBounds.left),this.ship.x>t.gameBounds.right&&(this.ship.x=t.gameBounds.right);for(var i=0;i<this.bombs.length;i++){
var s=this.bombs[i];s.y+=e*s.velocity,s.y>this.height&&this.bombs.splice(i--,1)}for(i=0;i<this.rockets.length;i++){var o=this.rockets[i];o.y-=e*o.velocity,o.y<0&&this.rockets.splice(i--,1);
}var n=!1,h=!1,a=!1;for(i=0;i<this.invaders.length;i++){var r=this.invaders[i],l=r.x+this.invaderVelocity.x*e,c=r.y+this.invaderVelocity.y*e;n===!1&&l<t.gameBounds.left?n=!0:h===!1&&l>t.gameBounds.right?h=!0:a===!1&&c>t.gameBounds.bottom&&(a=!0),
n||h||a||(r.x=l,r.y=c)}this.invadersAreDropping&&(this.invaderCurrentDropDistance+=this.invaderVelocity.y*e,this.invaderCurrentDropDistance>=this.config.invaderDropDistance&&(this.invadersAreDropping=!1,
this.invaderVelocity=this.invaderNextVelocity,this.invaderCurrentDropDistance=0)),n&&(this.invaderCurrentVelocity+=this.config.invaderAcceleration,this.invaderVelocity={
x:0,y:this.invaderCurrentVelocity},this.invadersAreDropping=!0,this.invaderNextVelocity={x:this.invaderCurrentVelocity,y:0}),h&&(this.invaderCurrentVelocity+=this.config.invaderAcceleration,
this.invaderVelocity={x:0,y:this.invaderCurrentVelocity},this.invadersAreDropping=!0,this.invaderNextVelocity={x:-this.invaderCurrentVelocity,y:0}),this.boss.x>400&&(this.boss.movedirection=1),
this.boss.x<200&&(this.boss.movedirection=-1),this.boss.x=this.boss.x-e*this.boss.movedirection*30,a&&(this.lives=0),this.invaders.map(function(e,i){var s=!1;this.rockets.map(function(e,o){
e.x>=this.invaders[i].x-this.invaders[i].width/2&&e.x<=this.invaders[i].x+this.invaders[i].width/2&&e.y>=this.invaders[i].y-this.invaders[i].height/2&&e.y<=this.invaders[i].y+this.invaders[i].height/2&&(this.rockets.splice(o--,1),
s=!0,t.score+=this.config.pointsPerInvader)}),s&&(this.invaders.splice(i--,1),t.sounds.playSound("bang"))});var d=this.boss,p=!1;this.rockets.map(function(e,i){e.x>=d.x-d.width/2&&e.x<=d.x+d.width/2&&e.y>=d.y-d.height/2&&e.y<=d.y+d.height/2&&(this.rockets.splice(i--,1),
p=!0,t.score+=this.config.pointsPerInvader)}),p&&(this.boss.hp=this.boss.hp-20,0===this.boss.hp,t.sounds.playSound("bang"));var f={};this.invaders.map(function(t){
(!f[t.file]||f[t.file].rank<t.rank)&&(f[t.file]=t)}),f.map(function(t){if(!t){var i=this.bombRate*e;i>Math.random()&&this.bombs.push(new Bomb(t.x,t.y+t.height/2,this.bombMinVelocity+Math.random()*(this.bombMaxVelocity-this.bombMinVelocity)));
}}),this.bombs.map(function(e){e.x>=this.ship.x-this.ship.width/2&&e.x<=this.ship.x+this.ship.width/2&&e.y>=this.ship.y-this.ship.height/2&&e.y<=this.ship.y+this.ship.height/2&&(this.bombs.splice(ibs--,1),
t.lives--,t.sounds.playSound("explosion"))}),this.invaders.map(function(e){e.x+e.width/2>this.ship.x-this.ship.width/2&&e.x-e.width/2<this.ship.x+this.ship.width/2&&e.y+e.height/2>this.ship.y-this.ship.height/2&&e.y-e.height/2<this.ship.y+this.ship.height/2&&(t.lives=0,
t.sounds.playSound("explosion"))}),t.lives<=0&&t.moveToState(new GameOverState),0===this.invaders.length&&0===this.boss.hp&&(t.score+=50*this.level,t.level+=1,t.moveToState(new LevelIntroState(t.level)));
},PlayState.prototype.draw=function(t,e,i){i.clearRect(0,0,t.width,t.height),i.fillStyle="#999999",i.fillRect(this.ship.x-this.ship.width/2,this.ship.y-this.ship.height/2,this.ship.width,this.ship.height),
i.drawImage(gameImages.keyboard,this.ship.x-this.ship.width/2,this.ship.y-this.ship.height/2,80,42),i.fillStyle="#006600",this.invaders.map(function(t){i.fillText("Test",t.x,t.y),
i.fillRect(t.x-t.width/2,t.y-t.height/2,t.width,t.height)}),i.fillStyle="#008800";var s=this.boss;i.fillRect(s.x-s.width/2,s.y-s.height/2,s.width,s.height),i.fillStyle="#ff5555",
this.bombs.map(function(t){i.fillRect(t.x-2,t.y-2,4,4)}),i.fillStyle="#ff0000",this.rockets.map(function(t){i.fillRect(t.x,t.y-2,8,8),i.drawImage(gameImages.keycaps[0],t.x,t.y-2,8,8);
});var o=t.gameBounds.bottom+(t.height-t.gameBounds.bottom)/2+7;i.font="14px Arial",i.fillStyle="#ffffff";var n="Lives: "+t.lives;i.textAlign="left",i.fillText(n,t.gameBounds.left,o),
n="Score: "+t.score+", Level: "+t.level,i.textAlign="right",i.fillText(n,t.gameBounds.right,o),this.config.debugMode&&(i.strokeStyle="#ff0000",i.strokeRect(0,0,t.width,t.height),
i.strokeRect(t.gameBounds.left,t.gameBounds.top,t.gameBounds.right-t.gameBounds.left,t.gameBounds.bottom-t.gameBounds.top))},PlayState.prototype.keyDown=function(t,e){
32==e&&this.fireRocket(),80==e&&t.pushState(new PauseState)},PlayState.prototype.keyUp=function(t,e){},PlayState.prototype.fireRocket=function(){(null===this.lastRocketTime||(new Date).valueOf()-this.lastRocketTime>1e3/this.config.rocketMaxFireRate)&&(this.rockets.push(new Rocket(this.ship.x,this.ship.y-12,this.config.rocketVelocity)),
this.lastRocketTime=(new Date).valueOf(),game.sounds.playSound("shoot"))},PauseState.prototype.keyDown=function(t,e){80==e&&t.popState()},PauseState.prototype.draw=function(t,e,i){
i.clearRect(0,0,t.width,t.height),i.font="14px Arial",i.fillStyle="#ffffff",i.textBaseline="middle",i.textAlign="center",i.fillText("Paused",t.width/2,t.height/2);
},LevelIntroState.prototype.update=function(t,e){void 0===this.countdown&&(this.countdown=3),this.countdown-=e,this.countdown<2&&(this.countdownMessage="2"),this.countdown<1&&(this.countdownMessage="1"),
this.countdown<=0&&t.moveToState(new PlayState(t.config,this.level))},LevelIntroState.prototype.draw=function(t,e,i){void 0===this.count&&(this.count=0),this.count+=e*t.config.fps,
i.font="68px Arial",i.textBaseline="middle",i.fillStyle="#ffffff",i.textAlign="center",i.fillText(this.IntroStageWord,t.width/2,46*Math.ceil(this.count/10)),i.clearRect(t.width/2-120,t.height/2-60,240,160),
i.fillStyle="#111111",i.fillRect(t.width/2-120,t.height/2-60,240,160),i.font="36px Arial",i.fillStyle="#ffffff",i.textBaseline="middle",i.textAlign="center",i.fillText("Level "+this.level,t.width/2,t.height/2),
i.font="24px Arial",i.fillText("Ready in "+this.countdownMessage,t.width/2,t.height/2+36)},Sounds.prototype.init=function(){context=window.AudioContext||window.webkitAudioContext,
this.audioContext=new context,this.mute=!1},Sounds.prototype.loadSound=function(t,e){var i=this;this.sounds[t]=null;var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",
s.onload=function(){i.audioContext.decodeAudioData(s.response,function(e){i.sounds[t]={buffer:e}})};try{s.send()}catch(e){console.log("An exception occured getting sound the sound "+t+" this might be because the page is running from the file system, not a webserver."),
console.log(e)}},Sounds.prototype.playSound=function(t){if(void 0!==this.sounds[t]&&null!==this.sounds[t]&&this.mute!==!0){var e=this.audioContext.createBufferSource();
e.buffer=this.sounds[t].buffer,e.connect(this.audioContext.destination),e.start(0)}};